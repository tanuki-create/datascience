# 座標圧縮 (Coordinate Compression)

## 概要

座標圧縮は、大きな値の座標を連続する小さな整数にマッピングするテクニックです。AtCoderで頻出のテクニックで、**値の範囲が大きいが、実際に使用される値が少ない場合**に威力を発揮します。セグメント木やFenwick Treeと組み合わせて使用されることが多いです。

## 基本概念

### 座標圧縮の手順

1. **値の収集**: 全てのユニークな値を収集
2. **ソート**: 値をソート
3. **マッピング**: 各値をインデックスにマッピング

### 主な操作と計算量

| 操作 | 時間計算量 | 空間計算量 | 適用場面 |
|------|-----------|-----------|---------|
| 圧縮 | O(n log n) | O(n) | 値のマッピング |
| 逆変換 | O(1) | O(1) | インデックスから値への変換 |

**注意**: 座標圧縮は、値の順序を保持しながら、値を小さな整数にマッピングします。

## いつ使うべきか

座標圧縮は以下のような場面で威力を発揮します：

### 1. 大きな値の範囲
- 値の範囲が10^9など大きいが、実際に使用される値が10^5程度
- セグメント木やFenwick Treeのサイズを削減

### 2. AtCoderの問題
- 座標の範囲が大きいが、実際の座標が少ない問題
- セグメント木と組み合わせて使用

### 3. 離散化が必要な問題
- 連続値を離散値に変換する必要がある問題

## 現実世界での応用例

### 1. データベースのインデックス
- **例**: データベースで、大きなIDを小さなインデックスにマッピング
- **実装**: 座標圧縮でIDをインデックスに変換
- **メリット**: インデックスのサイズを削減

### 2. 地理情報システム
- **例**: GISで、大きな座標を小さなインデックスにマッピング
- **実装**: 座標圧縮で座標をインデックスに変換
- **メリット**: メモリ効率的な処理

### 3. 画像処理
- **例**: 画像処理で、ピクセル座標を圧縮
- **実装**: 座標圧縮で座標をインデックスに変換
- **メリット**: 効率的な画像処理

### 4. ゲーム開発
- **例**: ゲームで、大きな座標を小さなインデックスにマッピング
- **実装**: 座標圧縮で座標をインデックスに変換
- **メリット**: 効率的なゲーム処理

### 5. データ分析
- **例**: データ分析で、大きな値を小さなインデックスにマッピング
- **実装**: 座標圧縮で値をインデックスに変換
- **メリット**: 効率的なデータ分析

### 6. ネットワーク分析
- **例**: ネットワーク分析で、大きなノードIDを小さなインデックスにマッピング
- **実装**: 座標圧縮でIDをインデックスに変換
- **メリット**: 効率的なネットワーク分析

## 実装時の注意点

### 1. 値の収集
- **問題**: 全てのユニークな値を収集する必要がある
- **解決策**: セットを使用してユニークな値を収集
- **実装**: `unique_values = sorted(set(values))`
- **注意**: ソートすることで、順序を保持

### 2. マッピングの作成
- **問題**: 値からインデックスへのマッピングを作成
- **解決策**: 辞書を使用してマッピングを作成
- **実装**: `compression = {val: idx for idx, val in enumerate(unique_values)}`
- **注意**: マッピングを正確に作成する必要がある

### 3. 逆変換
- **問題**: インデックスから値への逆変換が必要な場合
- **解決策**: 配列を使用して逆変換を実現
- **実装**: `decompression = unique_values`
- **注意**: 逆変換も効率的に実装可能

### 4. 時間計算量の理解
- **平均**: O(n log n) - ソートのコスト
- **最悪**: O(n log n) - 常に同じ時間計算量
- **空間**: O(n) - ユニークな値の配列とマッピング
- **注意**: ソートのコストが支配的

## 関連するLeetCode/AtCoder問題

### Medium
- [Coordinate Compression](./coordinate_compression_logic.md) - 座標圧縮の基本

### Hard
- [Count of Smaller Numbers After Self](../leetcode/hard/) - 座標圧縮 + セグメント木
- [Reverse Pairs](../leetcode/hard/) - 座標圧縮 + セグメント木

## 学習の進め方

1. **Coordinate Compression**から始める: 座標圧縮の最も基本的な例
2. **セグメント木と組み合わせ**: 座標圧縮 + セグメント木の問題に挑戦
3. **より複雑な問題**に挑戦: 他のテクニックと組み合わせた使用法を学ぶ

## 次のステップ

- [Coordinate Compression のロジック解説](./coordinate_compression_logic.md)
- [セグメント木テクニック](../25_segment_tree/README.md) - 座標圧縮と組み合わせて使用
- [累積和テクニック](../19_prefix_sum/README.md) - 座標圧縮と組み合わせて使用

---

**重要**: 座標圧縮は、AtCoderで頻出のテクニックです。大きな値の範囲を小さな整数にマッピングすることで、セグメント木などのデータ構造を効率的に使用できます。

