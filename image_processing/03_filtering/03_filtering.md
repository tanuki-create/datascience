# 画像フィルタリング

画像フィルタリングについて学びます。

## 目次

1. [畳み込み演算の原理](#畳み込み演算の原理)
2. [平滑化フィルタ](#平滑化フィルタ)
3. [シャープ化フィルタ](#シャープ化フィルタ)
4. [エッジ検出](#エッジ検出)
5. [カスタムフィルタ](#カスタムフィルタ)

---

## 畳み込み演算の原理

畳み込み演算は、画像処理の基本的な操作です。各ピクセルの値を、その周辺ピクセルとフィルタカーネル（重み行列）の積和で計算します。

### 数学的定義

畳み込み演算は以下の式で表されます：

```
I'(x,y) = Σ Σ I(x+i, y+j) × K(i, j)
         i j
```

ここで：
- `I(x,y)`: 元の画像のピクセル値
- `I'(x,y)`: フィルタ適用後のピクセル値
- `K(i,j)`: フィルタカーネル（重み行列）

### 実装例

```python
import cv2
import numpy as np

# カスタムカーネルの作成
kernel = np.array([
    [0, -1, 0],
    [-1, 5, -1],
    [0, -1, 0]
], dtype=np.float32)

# 畳み込み演算の適用
filtered = cv2.filter2D(image, -1, kernel)
```

### パディング

畳み込み演算では、画像の端の処理が重要です。一般的な方法：
- **ゼロパディング**: 境界外を0で埋める
- **リフレクトパディング**: 境界を鏡像で埋める
- **エッジパディング**: 境界の値を繰り返す

---

## 平滑化フィルタ

平滑化フィルタは、画像のノイズを除去し、細部を滑らかにするために使用されます。

### 平均フィルタ

平均フィルタは、各ピクセルをその周辺ピクセルの平均値で置き換えます。

**特徴**:
- シンプルで高速
- エッジがぼやける
- ノイズ除去に有効

**カーネル例（3×3）**:
```
1/9  1/9  1/9
1/9  1/9  1/9
1/9  1/9  1/9
```

### ガウシアンフィルタ

ガウシアンフィルタは、中心に近いピクセルにより大きな重みを付ける平滑化フィルタです。

**特徴**:
- 自然な平滑化
- エッジ保持が良い
- ノイズ除去に有効

**パラメータ**:
- `sigma`: 標準偏差（大きいほど強く平滑化）
- `kernel_size`: カーネルサイズ（通常は奇数）

### メディアンフィルタ

メディアンフィルタは、各ピクセルをその周辺ピクセルの中央値で置き換えます。

**特徴**:
- ソルト&ペッパーノイズに特に有効
- エッジを保持しながらノイズ除去
- 外れ値に強い

**実装例**:

```python
import cv2

# 平均フィルタ
avg_filtered = cv2.blur(image, (5, 5))

# ガウシアンフィルタ
gaussian_filtered = cv2.GaussianBlur(image, (5, 5), 0)

# メディアンフィルタ
median_filtered = cv2.medianBlur(image, 5)
```

---

## シャープ化フィルタ

ラプラシアンフィルタやアンシャープマスキングについて説明します。

### 実装例

```python
# 実装例をここに追加
pass
```

---

## エッジ検出

エッジ検出は、画像内の急激な輝度変化（エッジ）を検出する処理です。

### Sobel演算子

Sobel演算子は、一次微分を使用してエッジを検出します。

**特徴**:
- 水平方向と垂直方向のエッジを検出
- ノイズに比較的強い
- 計算が高速

**カーネル例（水平方向）**:
```
-1  0  1
-2  0  2
-1  0  1
```

### Cannyエッジ検出

Cannyエッジ検出は、多段階のアルゴリズムで高品質なエッジを検出します。

**処理ステップ**:
1. ガウシアンフィルタでノイズ除去
2. Sobel演算子で勾配計算
3. 非極大値抑制
4. ヒステリシス閾値処理

**特徴**:
- 高品質なエッジ検出
- ノイズに強い
- 細いエッジも検出可能

### Laplacian演算子

Laplacian演算子は、二次微分を使用してエッジを検出します。

**特徴**:
- エッジの位置を正確に検出
- ノイズに敏感
- ゼロ交差でエッジを検出

**実装例**:

```python
import cv2

# Sobelエッジ検出
sobelx = cv2.Sobel(image, cv2.CV_64F, 1, 0, ksize=3)
sobely = cv2.Sobel(image, cv2.CV_64F, 0, 1, ksize=3)
sobel = np.sqrt(sobelx**2 + sobely**2)

# Cannyエッジ検出
canny = cv2.Canny(image, 50, 150)

# Laplacianエッジ検出
laplacian = cv2.Laplacian(image, cv2.CV_64F)
```

---

## カスタムフィルタ

独自のフィルタカーネルを作成する方法を説明します。

### 実装例

```python
# 実装例をここに追加
pass
```

---

## 参考資料

- OpenCV公式ドキュメント: https://docs.opencv.org/
- scikit-image公式ドキュメント: https://scikit-image.org/
